# ** SAME AS install_mariadb.sh IN NORMAL BEHAVIOR **
# uninstall mariadb, from LAMP
sudo dnf remove -y mariadb

# download mariadb 
cd /home/vagrant
wget -r --no-parent -nH -nd -np -R index.html* http://ftp.hosteurope.de/mirror/archive.mariadb.org/mariadb-10.1.17/yum/fedora24-amd64/rpms/ 
wget https://rpmfind.net/linux/epel/7/x86_64/Packages/t/thrift-0.9.1-15.el7.x86_64.rpm
wget https://rpmfind.net/linux/fedora/linux/releases/27/Everything/x86_64/os/Packages/u/unixODBC-2.3.4-7.fc27.x86_64.rpm
wget https://rpmfind.net/linux/fedora/linux/releases/28/Everything/x86_64/os/Packages/j/Judy-1.0.5-17.fc28.x86_64.rpm
# resolve dependency issues
sudo dnf install -y libthrift-0.9.1.so libodbc.so.2 libJudy.so.1 jemalloc perl-Time-HiRes perl-DBI perl-Memoize galera
sudo dnf install -y jemalloc perl-Time-HiRes perl-DBI perl-Memoize galera
sudo dnf install -y thrift-0.9.1-15.el7.x86_64.rpm unixODBC-2.3.4-7.fc27.x86_64.rpm Judy-1.0.5-17.fc28.x86_64.rpm

sudo rpm -ivh MariaDB-*
# start 

# setting selinux to be permissive, otherwise, we would have gotten the following errors: 
# selinux is preventing mysqld from read access on the file plugin.frm
# selinux is preventing mysqld from write access on the directory /var/lib/mysql 
setenforce 0 
sudo systemctl start mysql

# setting mariadb and root passwd
printf '\ny\nvagrant\nvagrant\ny\ny\ny\ny' | mysql_secure_installation 


#change to file-based logging
sudo cat<<EOF>>/etc/my.cnf
[mysqld]
log-error=/var/lib/mysql/error.log
EOF
